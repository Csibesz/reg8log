<?phpif(ini_get('register_globals')) exit("<center><h3>Error: Turn that damned register globals off!</h3></center>");if(!isset($parent_page)) exit("<center><h3>Error: Direct access denied!</h3></center>");$color1='#aaa';$color2='#ccc';if($page*$per_page>$total) $less=($page*$per_page)-$total;else $less=0;$first=($page-1)*$per_page+1;$last=($page*$per_page-$less);$num=$last-$first+1;?><html <?php echo $page_dir; ?>><head><meta http-equiv="Content-type" content="text/html;charset=UTF-8" /><META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE"><META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE"><META HTTP-EQUIV="EXPIRES" CONTENT="0"><link href="../css/list.css" media="screen" rel="stylesheet" type="text/css" /><title><?php echo tr('Accounts'); ?></title><style></style><script src="../js/forms_common.js"></script><?php require $index_dir.'include/code/code_validate_captcha_field-js.php'; ?><script src="../js/sha256.js"></script><script><?phpecho "\nsite_salt='$site_salt';\n";?>var del_all_toggle_stat=false;//-----------------------function clear_form() {	document.accounts_form.password.value='';	clear_cap(false);	return false;}function hash_password() {	document.accounts_form.password.value='hashed-'+site_salt+'-'+hex_sha256(site_salt+document.accounts_form.password.value);}<?phpif(isset($password_check_needed)) echo 'password_exists=true;';else echo 'password_exists=false;';?>function validate() {//client side validator	msgs=new Array();	i=0;	if(password_exists) if(!document.accounts_form.password.value.length) msgs[i++]="<?php echo tr('password field is empty!'); ?>";	if(captcha_exists) validate_captcha(document.accounts_form.captcha.value);	if(msgs.length) {	clear_cap(false);	for(i in msgs){		msgs[i]=msgs[i].charAt(0).toUpperCase()+msgs[i].substring(1, msgs[i].length);		cap.appendChild(document.createTextNode(msgs[i]));		cap.appendChild(document.createElement("br"));	}	return false;	}	if(captcha_exists) {		form_obj=document.accounts_form;		check_captcha();		return false;	}	if(password_exists) hash_password();	return true;}//client side validator//-----------------------var tmp;function highlight(row) {	tmp=row.style.background;	row.style.background="#fff";}function unhighlight(row) {	row.style.background=tmp;}function delete_click(id, checked) {	if(!checked) normal(id);	else red(id);}function green(id) {	tmp=document.getElementById('row'+id).style.background="green";}function red(id) {	tmp=document.getElementById('row'+id).style.background="red";}function normal(id) {	if(id%2) tmp=document.getElementById('row'+id).style.background='<?php echo $color1 ?>';	else tmp=document.getElementById('row'+id).style.background='<?php echo $color2 ?>';}function check_all(action) {	<?php	echo "first=$first;\n";	echo "	num=$num;\n";	?>	for(i=first; i<first+num; i++) {		obj=document.getElementById(action+i);		if(del_all_toggle_stat) {			obj.checked=false;			normal(i-first+1);		}		else {			obj.checked=true;			red(i-first+1);		}	}	del_all_toggle_stat=!del_all_toggle_stat;	//if(del_all_toggle_stat) document.getElementById('check_all2').value='Unselect all';	//else document.getElementById('check_all2').value='Select all';}function is_digit(e) {	code = e.keyCode ? e.keyCode : e.which;	if(code<48 || code>57) return false;	else return true;}function validate_goto() {<?phpecho '	last_page=', ceil($total/$per_page), ";\n";?>	page=document.getElementById('page').value;	if(page<1 || page>last_page ) {		alert(<?php		echo "'", sprintf(tr('Page number must be between (including) 1 and %d.'), ceil($total/$per_page)), "'";		?>);		document.getElementById('page').value='';		return false;	}	else return true;}</script></head><body bgcolor="#7587b0" <?php echo $page_dir; ?>><center><?phpif(isset($password_msg)) {	echo '<table><tr align="center"><td colspan="3" style="border: solid thin yellow; font-style: italic; background: #555; padding: 3px;">';	echo "<span style=\"color: yellow\" >&nbsp;$password_msg&nbsp;</span><br />";	echo '</td></tr></table>';}else if(isset($captcha_msg) and count($err_msgs)==1) {	echo '<table><tr align="center"><td colspan="3" style="border: solid thin yellow; font-style: italic; background: #555; padding: 3px;">';	echo "<span style=\"color: yellow\" >&nbsp;$captcha_msg&nbsp;</span><br />";	echo '</td></tr></table>';}else if(!empty($err_msgs)) {	echo '<table><tr align="center"><td><div  style="border: solid thin orange; font-style: italic; background: #ccc; padding: 7px;"><span style="color: #800">', tr('Errors'), ':</span><br />';	foreach($err_msgs as $err_msg) {		$err_msg[0]=strtoupper($err_msg[0]);		echo "<span style=\"color: red\" >$err_msg</span><br />";	}	echo '<div style="height: 10px">&nbsp;</div></div></td></tr></table>';}?><form action="" method="post" name="accounts_form"><?phpecho tr('Records '), $first, tr(' - '), $last, tr(' of '), $total;echo '<table border cellpadding="3">';echo '<input type="hidden" name="antixsrf_token" value="';echo $_COOKIE['reg8log_antixsrf_token4post'];echo '">';require_once $index_dir.'include/func/func_duration2friendly_str.php';echo '<tr style="background: brown; color: #fff"><th></th>';echo '<th>';echo "<a class='header' href='?per_page=$per_page&page=$page&sort_by=uid&sort_dir=";if($sort_by=='uid' and $sort_dir=='asc') echo 'desc';else echo 'asc';echo "'>", tr('Uid'), "</a>";if($sort_by=='uid') {	echo '&nbsp;';	if($sort_dir=='asc') echo '<img src="../image/sort_asc.gif">';	else echo '<img src="../image/sort_desc.gif">';}echo "</th>";echo '<th>';echo "<a class='header' href='?per_page=$per_page&page=$page&sort_by=username&sort_dir=";if($sort_by=='username' and $sort_dir=='asc') echo 'desc';else echo 'asc';echo "'>", tr('Username'), "</a>";if($sort_by=='username') {	echo '&nbsp;';	if($sort_dir=='asc') echo '<img src="../image/sort_asc.gif">';	else echo '<img src="../image/sort_desc.gif">';}echo "</th>";echo '<th>';echo "<a class='header' href='?per_page=$per_page&page=$page&sort_by=gender&sort_dir=";if($sort_by=='gender' and $sort_dir=='asc') echo 'desc';else echo 'asc';echo "'>", tr('Gender'), "</a>";if($sort_by=='gender') {	echo '&nbsp;';	if($sort_dir=='asc') echo '<img src="../image/sort_asc.gif">';	else echo '<img src="../image/sort_desc.gif">';}echo "</th>";echo '<th>';echo "<a class='header' href='?per_page=$per_page&page=$page&sort_by=email&sort_dir=";if($sort_by=='email' and $sort_dir=='asc') echo 'desc';else echo 'asc';echo "'>", tr('Email'), "</a>";if($sort_by=='email') {	echo '&nbsp;';	if($sort_dir=='asc') echo '<img src="../image/sort_asc.gif">';	else echo '<img src="../image/sort_desc.gif">';}echo "</th>";echo '<th>';echo "<a class='header' href='?per_page=$per_page&page=$page&sort_by=timestamp&sort_dir=";if($sort_by=='timestamp' and $sort_dir=='asc') echo 'desc';else echo 'asc';echo "'>", tr('Account creation'), "</a>";if($sort_by=='timestamp') {	echo '&nbsp;';	if($sort_dir=='asc') echo '<img src="../image/sort_asc.gif">';	else echo '<img src="../image/sort_desc.gif">';}echo "</th>";if($log_last_login) {	echo '<th>';	echo "<a class='header' href='?per_page=$per_page&page=$page&sort_by=last_login&sort_dir=";	if($sort_by=='last_login' and $sort_dir=='asc') echo 'desc';	else echo 'asc';	echo "'>", tr('Last login'), "</a>";	if($sort_by=='last_login') {		echo '&nbsp;';		if($sort_dir=='asc') echo '<img src="../image/sort_asc.gif">';		else echo '<img src="../image/sort_desc.gif">';	}	echo "</th>";}if($log_last_activity) {	echo '<th>';	echo "<a class='header' href='?per_page=$per_page&page=$page&sort_by=last_activity&sort_dir=";	if($sort_by=='last_activity' and $sort_dir=='asc') echo 'desc';	else echo 'asc';	echo "'>", tr('Last activity'), "</a>";	if($sort_by=='last_activity') {		echo '&nbsp;';		if($sort_dir=='asc') echo '<img src="../image/sort_asc.gif">';		else echo '<img src="../image/sort_desc.gif">';	}	echo "</th>";}if($log_last_logout) {	echo '<th>';	echo "<a class='header' href='?per_page=$per_page&page=$page&sort_by=last_logout&sort_dir=";	if($sort_by=='last_logout' and $sort_dir=='asc') echo 'desc';	else echo 'asc';	echo "'>", tr('Last logout'), "</a>";	if($sort_by=='last_logout') {		echo '&nbsp;';		if($sort_dir=='asc') echo '<img src="../image/sort_asc.gif">';		else echo '<img src="../image/sort_desc.gif">';	}	echo "</th>";}echo '<th>';echo "<a class='header' href='?per_page=$per_page&page=$page&sort_by=banned&sort_dir=";if($sort_by=='banned' and $sort_dir=='asc') echo 'desc';else echo 'asc';echo "'>", tr('Banned'), "</a>";if($sort_by=='banned') {	echo '&nbsp;';	if($sort_dir=='asc') echo '<img src="../image/sort_asc.gif">';	else echo '<img src="../image/sort_desc.gif">';}echo "</th>";echo '<th  class="admin_action">', tr('Delete'), '</th></tr>';$i=0;$r=false;while($rec=$reg8log_db->fetch_row()) {	if(!$r) echo '<tr align="center" style="background: ', $color1,'" onmouseover="highlight(this);" onmouseout="unhighlight(this);"';	else echo '<tr align="center" style="background: ', $color2,'" onmouseover="highlight(this);" onmouseout="unhighlight(this);"';	$i++;	echo ' id="row', $i, '">';	$r=!$r;	$row=($page-1)*$per_page+$i;	echo '<td>', $row, '</td>';	echo '<td>', $rec['uid'], '</td>';	echo '<td>', htmlspecialchars($rec['username'], ENT_QUOTES, 'UTF-8'), '</td>';	echo '<td>';	if($rec['gender']=='n') echo '?';	else if($rec['gender']=='m') echo tr('Male');	else echo tr('Female');	echo '</td>';	echo '<td>', $rec['email'], '</td>';	echo '<td>', duration2friendly_str($req_time-$rec['timestamp'], 2), tr(' ago'), '</td>';	if($log_last_login) {		if($rec['last_login']) echo '<td>', duration2friendly_str($req_time-$rec['last_login'], 2), tr(' ago'), '</td>';		else echo '<td>', tr('N/A'), '</td>';	}	if($log_last_activity) {		if($rec['last_activity']) echo '<td>', duration2friendly_str($req_time-$rec['last_activity'], 2), tr(' ago'), '</td>';		else echo '<td>', tr('N/A'), '</td>';	} 	if($log_last_logout) {		if($rec['last_logout']) echo '<td>', duration2friendly_str($req_time-$rec['last_logout'], 2), tr(' ago'), '</td>';		else echo '<td>', tr('N/A'), '</td>';	}	if($rec['banned']==1 or $rec['banned']>$req_time) echo '<td>', tr('Yes'), '</td>';	else echo '<td>', tr('No'), '</td>';	echo '<td><input type="checkbox" name="', $rec['auto'], '" id="del', $row, '" value="del" onclick="delete_click(', $i, ', ', 'this.checked)"';	if(isset($_POST[$rec['auto']])) {		echo ' checked ';		$checkeds[]=$i;	}	echo '></td></tr>';}echo '<tr ';if(!$r) echo ' style="background: ', $color1;else echo ' style="background: ', $color2;echo '">';$colspan=7;if($log_last_activity) $colspan++;if($log_last_logout) $colspan++;if($log_last_login) $colspan++;echo "<td colspan=\"$colspan\">";//unset($captcha_needed);if(isset($captcha_needed) and !$captcha_verified) echo '<table align=center style="border: thin solid #000; background: #bbb"><tr><td>';else echo '<table cellspacing=0 cellpadding=0><tr><td>';if(isset($password_check_needed)) {	echo tr('Admin password'), ': <input type="password" name="password">&nbsp;';}if(isset($captcha_needed) and !$captcha_verified) {	echo '</td></tr><tr align=center><td>';	$captcha_form4login=true;	require $index_dir.'include/page/page_captcha_form.php';	echo '</td></tr>';	echo '<tr align=center><td>';}if(isset($password_check_needed)) {	echo '<input type="reset" value="', tr('Clear') ,'" onClick="return clear_form()" />', '&nbsp;';}	echo '<input type="submit" value="', tr('Delete selected accounts'), '" style="color: red;" name="delete" onclick="return validate();">';if(isset($captcha_needed) and !$captcha_verified) echo '<br>';else echo '&nbsp;&nbsp;&nbsp;';echo '<span style="color: red; font-style: italic" id="cap"></span></td></tr></table></td><td valign=top><input type="button" onclick="check_all(\'del\')" value="', tr('All'), '" disabled id="check_all2"></td></tr>';echo '</table>';echo '<script>';echo "\ndocument.getElementById('check_all2').disabled=false;\n";echo '</script>';require $index_dir.'include/page/admin/page_gen_paginated_page_links.php';if($total>$per_pages[0]) {	if($total<=$per_page) echo '<br>';	echo '<br>', tr('Records per page'), ': <select name="per_page" onchange="document.accounts_form.change_per_page.click()">';	foreach($per_pages as $value) {		if($value!=$per_page) echo "<option>$value</option>";		else echo "<option selected>$value</option>";	}	echo '</select>&nbsp;<input type="submit" value="', tr('Show'), '" name="change_per_page" style="display: visible">';	echo  '<script>	document.accounts_form.change_per_page.style.display="none";	</script>';}?></form><a href="index.php"><?php echo tr('Admin operations'); ?></a><br><br><a href="../index.php"><?php echo tr('Login page'); ?></a></center><script>if(captcha_exists) {	document.getElementById('re_captcha_msg').style.visibility='visible';	captcha_img_style=document.getElementById('captcha_image').style;	captcha_img_style.cursor='hand';	if(captcha_img_style.cursor!='hand') captcha_img_style.cursor='pointer';}</script><script>checkeds=new Array(<?php$flag=false;if(isset($checkeds)) foreach($checkeds as $v) {	if($flag) echo ', ';	else $flag=true;	echo "'$v'";}?>);for(var i in checkeds) red(checkeds[i]);</script><?phprequire $index_dir.'include/page/page_foot_codes.php';?></body></html>